<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Powertown MVP ‚Äî Review Park</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 20px; max-width: 900px; }
      a { text-decoration: none; }
      .card { border: 1px solid #ddd; border-radius: 10px; padding: 14px; margin-top: 12px; }
      .muted { color: #666; }
    </style>
  </head>
  <body>
    <h1>{{ park.name }}</h1>
    <p class="muted">{{ park.location or "" }}</p>

    
    <p>
      <a href="/review">‚Üê Back to all parks</a>
      <span class="muted"> | </span>
      <a href="/capture">+ New capture</a>
      <span class="muted"> | </span>
      <a href="/export/csv?park_id={{ park.id }}">Export CSV</a>
      <span class="muted"> | </span>
      <a href="/export/observations.csv?park_id={{ park.id }}">Export observations</a>
    </p>
    <p class="muted">
  Filter:
  <a href="/review/parks/{{ park.id }}">all</a> |
  <a href="/review/parks/{{ park.id }}?status=new">new</a> |
  <a href="/review/parks/{{ park.id }}?status=reviewed">reviewed</a> |
  <a href="/review/parks/{{ park.id }}?status=shortlisted">shortlisted</a>
</p>


    <div class="card">
      <div><strong>Park Summary</strong></div>
      <div class="muted" style="margin-top: 6px;">
	{{ park_summary.building_count }} buildings ¬∑
	avg {{ park_summary.avg_score }}/100 ¬∑
	{{ park_summary.count_70_plus }} ‚â• 70 ¬∑
	{{ park_summary.count_50_plus }} ‚â• 50
      </div>
    </div>

    <div class="card">
      <div><strong>Top Candidates</strong></div>

      {% if top_candidates|length == 0 %}
      <p class="muted">No buildings yet.</p>
      {% endif %}

      {% for c in top_candidates %}
      <div style="display:flex; justify-content: space-between; gap: 10px; margin-top: 10px;">
	<div>
          <strong><a href="/review/buildings/{{ c.building.id }}">{{ c.building.name }}</a></strong>
          <div class="muted">{{ c.building.address or "" }}</div>
          {% if c.score.drivers and c.score.drivers|length > 0 %}
          <div class="muted">{{ c.score.drivers[0] }}{% if c.score.drivers|length > 1 %}, {{ c.score.drivers[1] }}{% endif %}</div>
          {% endif %}
	</div>
	<div style="text-align:right;">
          <div style="font-size: 18px; font-weight: 700;">{{ c.score.score }}/100</div>
          <div class="muted">{{ c.score.confidence }}</div>
	</div>
      </div>
      {% endfor %}
    </div>

    <div class="card">
      <div style="display:flex; justify-content: space-between; align-items: baseline;">
	<div><strong>Recent Activity</strong></div>
	<div class="muted">latest observations in this park</div>
      </div>

      {% if recent_activity|length == 0 %}
      <p class="muted">No observations yet.</p>
      {% endif %}

      {% for a in recent_activity %}
      <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee;">
	<div class="muted">
          {{ a.observation.created_at }}
          {% if a.building %}
          ‚Äî <a href="/review/buildings/{{ a.building.id }}"><strong>{{ a.building.name }}</strong></a>
          {% else %}
          ‚Äî Building #{{ a.observation.building_id }}
          {% endif %}

          {% if a.media_count and a.media_count > 0 %}
          <span class="muted"> ¬∑ </span>
          <span>üìé {{ a.media_count }}</span>
          {% if a.photo_count and a.photo_count > 0 %}
          <span class="muted"> (üì∑ {{ a.photo_count }})</span>
          {% endif %}
          {% endif %}
	</div>

	{% if a.snippet %}
        <div style="margin-top: 6px;">{{ a.snippet }}</div>
	{% else %}
        <div class="muted" style="margin-top: 6px;">(no notes)</div>
	{% endif %}
      </div>
      {% endfor %}
    </div>

    <h2>Buildings</h2>
    {% if building_cards|length == 0 %}
  <p class="muted">No buildings yet.</p>
{% endif %}

{% for c in building_cards %}
  <div class="card">
    <div style="display:flex; justify-content: space-between; gap: 10px;">
      <div>
        <strong>
          <a href="/review/buildings/{{ c.building.id }}">
            {{ c.building.name }}
          </a>
        </strong>
        <div class="muted">{{ c.building.address or "" }}</div>
      </div>
      <div style="text-align:right;">
        <div style="font-size: 18px; font-weight: 700;">
          {{ c.score.score }}/100
        </div>
        <div class="muted">{{ c.score.confidence }}</div>
      </div>
    </div>
  </div>
  {% endfor %}
  </body>
</html>
