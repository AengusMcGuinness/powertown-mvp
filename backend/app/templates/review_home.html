<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Powertown MVP â€” Review</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 20px; max-width: 950px; }
      .topbar { display:flex; justify-content: space-between; align-items: baseline; }
      a { text-decoration: none; }
      .card { border: 1px solid #ddd; border-radius: 12px; padding: 14px; margin-top: 12px; }
      .muted { color: #666; }
      .pill { display:inline-block; padding: 2px 8px; border-radius: 999px; border:1px solid #ddd; margin-right: 8px; font-size: 12px; }
    </style>
  </head>
  <body>
    <div class="topbar">
      <h1>Review</h1>
      <div>
	<a href="/search">Search</a>
	<span class="muted"> | </span>
	<a href="/export/csv">Export all CSV</a>
	<span class="muted"> | </span>
	<a href="/capture">+ New capture</a>
      </div>
    </div>
    <p class="muted">Industrial parks and recent activity.</p>

    {% if park_cards|length == 0 %}
      <p class="muted">No parks yet. Start with <a href="/capture">Field Capture</a>.</p>
      {% endif %}

      <form method="get" action="/review" class="card" style="margin-top: 14px;">
  <div style="display:flex; gap: 12px; flex-wrap: wrap; align-items: end;">
    <div style="flex: 1; min-width: 180px;">
      <div class="muted" style="margin-bottom: 6px;">Min score</div>
      <input name="min_score" value="{{ filters.min_score }}" type="number" min="0" max="100" />
    </div>

    <div style="flex: 1; min-width: 180px;">
      <div class="muted" style="margin-bottom: 6px;">Activity in last (hours)</div>
      <input name="since_hours" value="{{ filters.since_hours }}" type="number" min="1" />
    </div>

    <div style="flex: 1; min-width: 200px;">
      <div class="muted" style="margin-bottom: 6px;">Sort</div>
      <select name="sort">
        <option value="last_activity" {% if filters.sort == "last_activity" %}selected{% endif %}>last activity</option>
        <option value="best_score" {% if filters.sort == "best_score" %}selected{% endif %}>best score</option>
      </select>
    </div>

    <div style="min-width: 160px;">
      <label style="display:flex; gap: 8px; align-items: center;">
        <input type="checkbox" name="only_active" value="true" {% if filters.only_active %}checked{% endif %} />
        <span class="muted">only active</span>
      </label>
    </div>

    <div>
      <button type="submit" style="padding: 10px 14px; font-weight: 600; cursor: pointer;">Apply</button>
      <a class="muted" href="/review" style="margin-left: 10px;">Reset</a>
    </div>
  </div>
</form>
      <div class="card">
  <div style="display:flex; justify-content: space-between; align-items: baseline;">
    <div><strong>Recent Activity</strong></div>
    <div class="muted">across all parks</div>
  </div>

  {% if recent_activity|length == 0 %}
    <p class="muted">No observations yet.</p>
  {% endif %}

  {% for a in recent_activity %}
    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee;">
      <div class="muted">
        {{ a.observation.created_at }}
        {% if a.park %}
          â€” <a href="/review/parks/{{ a.park.id }}"><strong>{{ a.park.name }}</strong></a>
        {% endif %}
        {% if a.building %}
          â€” <a href="/review/buildings/{{ a.building.id }}">{{ a.building.name }}</a>
        {% endif %}

        {% if a.media_count and a.media_count > 0 %}
          <span class="muted"> Â· </span>
          <span>ðŸ“Ž {{ a.media_count }}</span>
          {% if a.photo_count and a.photo_count > 0 %}
            <span class="muted">(ðŸ“· {{ a.photo_count }})</span>
          {% endif %}
        {% endif %}
      </div>

      {% if a.snippet %}
        <div style="margin-top: 6px;">{{ a.snippet }}</div>
      {% else %}
        <div class="muted" style="margin-top: 6px;">(no notes)</div>
      {% endif %}
    </div>
  {% endfor %}
</div>
      
    {% for c in park_cards %}
      <div class="card">
        <div>
          <strong>
            <a href="/review/parks/{{ c.park.id }}">{{ c.park.name }}</a>
          </strong>
          {% if c.park.location %}
            <span class="muted"> â€” {{ c.park.location }}</span>
            {% endif %}
	    <span class="muted"> | </span>
	    <span>{{ c.best_score or "â€”" }}/100 best</span>
        </div>
        <div style="margin-top: 8px;">
          <span class="pill">{{ c.building_count }} buildings</span>
          {% if c.last_activity %}
            <span class="pill">last activity: {{ c.last_activity }}</span>
          {% else %}
            <span class="pill">no observations yet</span>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </body>
</html>
